University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2022/2023

Group: K34212

Author: Komarov Alexey Nikolaevich

Lab: Lab2

Date of create: 1.12.2022

Date of finished: 

# Лабораторная работа №4 "Базовая 'коммутация' и туннелирование используя язык программирования P4"

## Описание
   В данной лабораторной работе ознакомлены на практике с языком программирования P4, разработанный компанией Barefoot (ныне Intel) для организации процесса обработки сетевого трафика на скорости чипа. Barefoot разработал несколько FPGA чипов для обработки трафика которые были встроенны в некоторые модели коммутаторов Arista и Brocade.
   
## Цель работы:
   Изучить синтаксис языка программирования P4 и выполнить 2 задания обучающих задания от Open network foundation для ознакомления на практике с P4.

## Ход работы:
   
   1. Установлен Vagrant, а также склонирован репозиторий с заданиями https://github.com/p4lang/tutorials.
   
   ![OpenVPN UI](/lab4/lab_4_1.png)
   
   2. Создана виртуальная машина с помощью команды vagrant up.

   ![OpenVPN UI](/lab4/lab_4_2.png)
   
   ![OpenVPN UI](/lab4/lab_4_3.png)

   
   3. Выполнен вход под учетной записью p4/p4.

   ![OpenVPN UI](/lab4/lab_4_4.png)
   
   4. Выполнена команда make run, а затем проверена доступность узлов. Как мы видим, сейчас узлы недоступны, что и нужно будет исправить.
   
   ![OpenVPN UI](/lab4/lab_4_5.png)
   
   ![OpenVPN UI](/lab4/lab_4_6.png)
   
   5. Был изменен файл basic.p4:
   - Обновлен парсер, который позволяет заполнять заголовки ethernet_t, ipv4_t.
   
   ![OpenVPN UI](/lab4/lab_4_7.png)
   
   - В MyIngress дополнено action ip4_forward: был определен выходной порт, обновлен адрес назначения пакета, обновлен источник отправления пакета, уменьшено значение TTL, обеспечено применение ipv4_lpm, если заголовок ipv4 верный.
   
   ![OpenVPN UI](/lab4/lab_4_8.png)
   
   6. Выполнена проверка доступности устройств.
   
   ![OpenVPN UI](/lab4/lab_4_9.png)
   
   7. Теперь приступаем ко второй части лабораторной работы. А именно к созданию туннелирования.
   8. Изменен файл basic_tunnel.p4:

   - Обновлен парсер myParser, а именно, добавлена функция заполненения заголовка myTunnel.
   
   ![OpenVPN UI](/lab4/lab_4_10.png)
   
   - Определено действие myTunnel_forward, которое назначает выходной порт, определена таблица myTunnel_exact, обновлено выражение apply. Оно позволяет применять myTunnel_exact, если заголовок myTunell валидный.
   
   ![OpenVPN UI](/lab4/lab_4_11.png)
      
   - Был обновлен MyDeparser
   
   ![OpenVPN UI](/lab4/lab_4_12.png)

   9. Проверена локальная связность.
   
   ![OpenVPN UI](/lab4/lab_4_13.png)

   10. Выполнена проверка скрипта, с h1 был оправлен пакет на h2 без туннелирования.
   
   ![OpenVPN UI](/lab4/lab_4_14.png)
   
   11. Теперь проверим работу туннеля. Отправлен пакет с h1 на h2 через туннель. Как мы видим, пакет дошел до получателя с верным сообщением.
   
   ![OpenVPN UI](/lab4/lab_4_15.png)

## Выводы
Было детально разобрано стандартное перенаправление пакетов, а также туннелирование, и данные механизмы реализованы посредством языка P4.


   ![OpenVPN UI](/lab4/lab_4_16.png)
